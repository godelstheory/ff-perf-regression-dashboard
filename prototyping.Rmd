---
title: "ff-perf-regression-dashboard-munge"
output: html_notebook
---

Load up the dataset from a pyspark `write.csv`

```{r}
library(lubridate)

df <- NULL
for (file_name in list.files('data', full.names=TRUE, pattern = 'part*')){
  df <- rbind(df, read.csv(file_name))
  # print(head(read.csv(file_name)))
}

df$creation_date <- ymd(df$creation_date)
```

Retrieve the most current values for each `build_id`

```{r}
library(dplyr)
df_clean <- df %>% group_by(app_build_id, probe) %>% filter(creation_date==max(creation_date)) %>% arrange(desc(app_build_id))
```

```{r}
library('ggplot2')

probe <- unique(df_clean$probe)[2]
probe_df <- df_clean[df_clean$probe==probe, ]
probe_df$thresh <- probe_df$relds_95 >= 0.30

cbPalette <- c("black", "red")
ggplot(probe_df, aes(x=app_build_id, y=relds_5, color=thresh, shape=thresh)) + 
  geom_point(aes(size=probe_df$num_profiles)) +
  geom_errorbar(aes(ymin=relds_25, ymax=relds_95), width=.1) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  scale_colour_manual(values=cbPalette) +
  geom_hline(yintercept=0.30, linetype="dashed", color = "red") +
  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = 'black'))+
  ggtitle(probe)
```

